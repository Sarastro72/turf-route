<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>Turf Routes 𝛼</title>
    <script src="js/lib/p5.min.js" type="text/javascript"></script>
    <script src="js/lib/mappa.js" type="text/javascript"></script>
    <script src="js/mappa_module.js" type="text/javascript"></script>
</head>

<body>
<script>
    initZoneMap(refreshMap)

    let fetchJob = null

    function refreshMap(bounds) {
        if (fetchJob) clearTimeout(fetchJob)
        fetchJob = setTimeout(() => {
            fetchJob = null
            let sw = bounds.sw
            let ne = bounds.ne
            fetch(`/zone/area/${sw.lat}/${sw.long}/${ne.lat}/${ne.long}`)
                .then(response => response.json())
                .then(zones => {
                    let nRoutes = 0
                    zones.forEach(z => nRoutes += drawRoutes(z))
                    zones.forEach(z => drawZone(z))
                    console.log(`Drew ${zones.length} zones and ${nRoutes} routes`)
                });
        }, 200)
    }
</script>
</body>
</html>
